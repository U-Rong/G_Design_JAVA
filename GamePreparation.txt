package controller.game;

import java.awt.EventQueue;
import java.awt.Image;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;

import controller.loginnsignup.LoginUI;
import dao.UImethods.TextAnimator;
import model.Princes;
import util.cal;

import javax.swing.JLabel;
import javax.swing.ImageIcon;
import javax.swing.JButton;

import java.awt.Color;
import javax.swing.SwingConstants;
import java.awt.Font;

public class GamePreparation extends JFrame {

	private static final long serialVersionUID = 1L;
	private JPanel contentPane;
	private final JPanel panel_3_4 = new JPanel();
	
	/**
	 * Launch the application.
	 */
	public static void main(String[] args) {
		EventQueue.invokeLater(new Runnable() {
			public void run() {
				try {
					GamePreparation frame = new GamePreparation();
					frame.setVisible(true);
				} catch (Exception e) {
					e.printStackTrace();
				}
			}
		});
	}

	/**
	 * Create the frame.
	 */
	public GamePreparation() {
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		setBounds(100, 100, 1280, 800);
		setLocationRelativeTo(null);
		contentPane = new JPanel();
		contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));

		//NPC頭像設置
		JLabel NPC_P = new JLabel("");
		NPC_P.setIcon(new ImageIcon(GamePreparation.class.getResource("/controller/loginnsignup/gallery/玩家.png")));
		NPC_P.setHorizontalAlignment(SwingConstants.CENTER);
		NPC_P.setBounds(10, 461, 250, 300);
		contentPane.add(NPC_P);
								
		ImageIcon imageIcon_P = new ImageIcon(LoginUI.class.getResource("/controller/loginnsignup/gallery/玩家.png"));
		int originalWidth_P = imageIcon_P.getIconWidth();
		int originalHeight_P = imageIcon_P.getIconHeight();
		double scaleFactor_P = Math.min(1.0 * NPC_P.getWidth() / originalWidth_P, 1.0 * NPC_P.getHeight() / originalHeight_P);
		int scaledWidth_P = (int) (originalWidth_P * scaleFactor_P);
		int scaledHeight_P = (int) (originalHeight_P * scaleFactor_P);
		Image scaledImage_P = imageIcon_P.getImage().getScaledInstance(scaledWidth_P, scaledHeight_P, Image.SCALE_SMOOTH);
		ImageIcon scaledIcon_P = new ImageIcon(scaledImage_P);
		NPC_P.setIcon(scaledIcon_P);
		NPC_P.setVisible(false);
		
		//NPC頭像設置
		JLabel NPC_2 = new JLabel("");
		NPC_2.setIcon(new ImageIcon(GamePreparation.class.getResource("/controller/loginnsignup/gallery/方悅.png")));
		NPC_2.setHorizontalAlignment(SwingConstants.CENTER);
		NPC_2.setBounds(10, 461, 250, 300);
		contentPane.add(NPC_2);
						
		ImageIcon imageIcon_M = new ImageIcon(LoginUI.class.getResource("/controller/loginnsignup/gallery/方悅.png"));
		int originalWidth_M = imageIcon_M.getIconWidth();
		int originalHeight_M = imageIcon_M.getIconHeight();
		double scaleFactor_M = Math.min(1.0 * NPC_2.getWidth() / originalWidth_M, 1.0 * NPC_2.getHeight() / originalHeight_M);
		int scaledWidth_M = (int) (originalWidth_M * scaleFactor_M);
		int scaledHeight_M = (int) (originalHeight_M * scaleFactor_M);
		Image scaledImage_M = imageIcon_M.getImage().getScaledInstance(scaledWidth_M, scaledHeight_M, Image.SCALE_SMOOTH);
		ImageIcon scaledIcon_M = new ImageIcon(scaledImage_M);
		NPC_2.setIcon(scaledIcon_M);
		NPC_2.setVisible(false);
		
		//NPC頭像設置
		JLabel NPC_1 = new JLabel("");
		NPC_1.setIcon(new ImageIcon(GamePreparation.class.getResource("/controller/loginnsignup/gallery/兵長.png")));
		NPC_1.setHorizontalAlignment(SwingConstants.CENTER);
		NPC_1.setBounds(10, 461, 250, 300);
		contentPane.add(NPC_1);
				
		ImageIcon imageIcon = new ImageIcon(LoginUI.class.getResource("/controller/loginnsignup/gallery/兵長.png"));
		int originalWidth = imageIcon.getIconWidth();
		int originalHeight = imageIcon.getIconHeight();
		double scaleFactor = Math.min(1.0 * NPC_1.getWidth() / originalWidth, 1.0 * NPC_1.getHeight() / originalHeight);
		int scaledWidth = (int) (originalWidth * scaleFactor);
		int scaledHeight = (int) (originalHeight * scaleFactor);
		Image scaledImage = imageIcon.getImage().getScaledInstance(scaledWidth, scaledHeight, Image.SCALE_SMOOTH);
		ImageIcon scaledIcon = new ImageIcon(scaledImage);
		NPC_1.setIcon(scaledIcon);
		NPC_1.setVisible(true);
		
		setContentPane(contentPane);
		contentPane.setLayout(null);
		panel_3_4.setBackground(new Color(0, 0, 0));
		panel_3_4.setForeground(new Color(0, 0, 0));
		panel_3_4.setBounds(0, 553, 1264, 208);
		contentPane.add(panel_3_4);
		panel_3_4.setVisible(false);
		
		
		//================================
		
        
        JPanel panel_1_2 = new JPanel();
		panel_1_2.setBackground(new Color(0, 0, 0));
		panel_1_2.setBounds(0, 553, 1264, 208);
		contentPane.add(panel_1_2);
		panel_1_2.setLayout(null);
		
		//讀取先前儲存的txt，並調用裡面的內容。
		Princes p_txt = (Princes)(cal.readFile("princes.txt"));
		
		
		
		JLabel Conversation_BG_M = new JLabel("");
		Conversation_BG_M.setBounds(0, 0, 1264, 761);
		contentPane.add(Conversation_BG_M);
		setScaledImage(Conversation_BG_M,"/controller/loginnsignup/gallery/PreparationBG.jpg");
		Conversation_BG_M.setVisible(false);

		JLabel BG = new JLabel("");
		BG.setBounds(0, 0, 1264, 761);
		contentPane.add(BG);
		setScaledImage(BG,"/controller/loginnsignup/gallery/PreparationBG.jpg");
		
		// 按鈕選項(開場)
        JButton Opening_Choosen = new JButton("");
        Opening_Choosen.setBounds(367, 75, 887, 59);
        panel_1_2.add(Opening_Choosen);
        Opening_Choosen.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                
            }
        });
        Opening_Choosen.setHorizontalAlignment(SwingConstants.LEFT);
        Opening_Choosen.setForeground(Color.WHITE);
        Opening_Choosen.setFont(new Font("新宋体", Font.BOLD, 20));
        Opening_Choosen.setBackground(Color.BLACK);
        Opening_Choosen.setVisible(true);
		
		 // 按鈕選項(1)
        JButton Q_1_Choosen_1 = new JButton("");
        Q_1_Choosen_1.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
            	
            }
        });
        Q_1_Choosen_1.setHorizontalAlignment(SwingConstants.LEFT);
        Q_1_Choosen_1.setForeground(new Color(255, 255, 255));
        Q_1_Choosen_1.setFont(new Font("新宋体", Font.BOLD, 20));
        Q_1_Choosen_1.setBackground(new Color(0, 0, 0));
        Q_1_Choosen_1.setBounds(367, 11, 887, 59);
        panel_1_2.add(Q_1_Choosen_1);
        Q_1_Choosen_1.setVisible(false);
        
        // 按鈕選項(2)
        JButton Q_1_Choosen_2 = new JButton("");
        Q_1_Choosen_2.setBounds(367, 75, 887, 59);
        panel_1_2.add(Q_1_Choosen_2);
        Q_1_Choosen_2.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                
            }
        });
        Q_1_Choosen_2.setHorizontalAlignment(SwingConstants.LEFT);
        Q_1_Choosen_2.setForeground(Color.WHITE);
        Q_1_Choosen_2.setFont(new Font("新宋体", Font.BOLD, 20));
        Q_1_Choosen_2.setBackground(Color.BLACK);
        Q_1_Choosen_2.setVisible(false);
        
        // 按鈕選項(3)
        JButton Q_1_Choosen_3 = new JButton("");
        Q_1_Choosen_3.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                
            }
        });
        Q_1_Choosen_3.setHorizontalAlignment(SwingConstants.LEFT);
        Q_1_Choosen_3.setForeground(Color.WHITE);
        Q_1_Choosen_3.setFont(new Font("新宋体", Font.BOLD, 20));
        Q_1_Choosen_3.setBackground(Color.BLACK);
        Q_1_Choosen_3.setBounds(367, 138, 887, 59);
        panel_1_2.add(Q_1_Choosen_3);
        Q_1_Choosen_3.setVisible(false);
        
        // 按鈕選項(轉場)
        JButton Loading_Choosen = new JButton("");
        Loading_Choosen.setBounds(367, 75, 887, 59);
        panel_3_4.add(Loading_Choosen);
        Loading_Choosen.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
            }
        });
        Loading_Choosen.setHorizontalAlignment(SwingConstants.LEFT);
        Loading_Choosen.setForeground(Color.WHITE);
        Loading_Choosen.setFont(new Font("新宋体", Font.BOLD, 20));
        Loading_Choosen.setBackground(Color.BLACK);
        Loading_Choosen.setVisible(false);
        
        // 按鈕選項(1)
        JButton Q_2_Choosen_1 = new JButton("");
        Q_2_Choosen_1.setBounds(367, 11, 887, 59);
        panel_3_4.add(Q_2_Choosen_1);
        Q_2_Choosen_1.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
            }
        });
        Q_2_Choosen_1.setHorizontalAlignment(SwingConstants.LEFT);
        Q_2_Choosen_1.setForeground(Color.WHITE);
        Q_2_Choosen_1.setFont(new Font("新宋体", Font.BOLD, 20));
        Q_2_Choosen_1.setBackground(Color.BLACK);
        Q_2_Choosen_1.setVisible(false);
        
        // 按鈕選項(2)
        JButton Q_2_Choosen_2 = new JButton("");
        Q_2_Choosen_2.setBounds(367, 75, 887, 59);
        panel_3_4.add(Q_2_Choosen_2);
        Q_2_Choosen_2.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
            }
        });
        Q_2_Choosen_2.setHorizontalAlignment(SwingConstants.LEFT);
        Q_2_Choosen_2.setForeground(Color.WHITE);
        Q_2_Choosen_2.setFont(new Font("新宋体", Font.BOLD, 20));
        Q_2_Choosen_2.setBackground(Color.BLACK);
        Q_2_Choosen_2.setVisible(false);
        
        // 按鈕選項(3)
        JButton Q_2_Choosen_3 = new JButton("");
        Q_2_Choosen_3.setBounds(367, 138, 887, 59);
        panel_3_4.add(Q_2_Choosen_3);
        Q_2_Choosen_3.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
            }
        });
        Q_2_Choosen_3.setHorizontalAlignment(SwingConstants.LEFT);
        Q_2_Choosen_3.setForeground(Color.WHITE);
        Q_2_Choosen_3.setFont(new Font("新宋体", Font.BOLD, 20));
        Q_2_Choosen_3.setBackground(Color.BLACK);
        Q_2_Choosen_3.setVisible(false);
      
        
        //文字對話互動
        JLabel Conversation_2 = new JLabel("");
        Conversation_2.setForeground(new Color(255, 255, 255));
        Conversation_2.setFont(new Font("新宋体", Font.BOLD, 20));
        Conversation_2.setBounds(367, 35, 887, 162);
        panel_3_4.add(Conversation_2);
        
        JLabel Wu_name = new JLabel("【武安國】");
	    Wu_name.setFont(new Font("新宋体", Font.BOLD, 25));
	    Wu_name.setHorizontalAlignment(SwingConstants.LEFT);
	    Wu_name.setForeground(new Color(255, 255, 255));
	    Wu_name.setBounds(254, 11, 136, 35);
		panel_3_4.add(Wu_name);
        
        JLabel My_name = new JLabel(p_txt.getJ_Name());
        My_name.setFont(new Font("新宋体", Font.BOLD, 25));
        My_name.setHorizontalAlignment(SwingConstants.LEFT);
        My_name.setForeground(new Color(255, 255, 255));
        My_name.setBounds(254, 11, 136, 35);
		panel_3_4.add(My_name);
		My_name.setVisible(false);
                
        //武安國提問
        Loading_Choosen.setVisible(true);
        Loading_Choosen.setText("呂布這狂徒，膽敢如此囂張！老子親自出馬...與他一戰決勝負！");
        Loading_Choosen.addMouseListener(new MouseAdapter() {
			@Override
        	public void mouseClicked(MouseEvent e) {
				Loading_Choosen.setVisible(false);
				Wu_name.setVisible(false);
				NPC_2.setVisible(false);
				TextAnimator animator2 = new TextAnimator(Conversation_2, "戰鼓震天，震耳欲聾，營帳內諸將嚴陣以待，戰場氣氛緊張而壓...", 200, new Runnable() {
		            @Override
		            public void run() {
		            	Wu_name.setVisible(true);
				        Wu_name.setText("兵長");
				        NPC_1.setVisible(true);
		            	TextAnimator animator2_1 = new TextAnimator(Conversation_2, "(氣喘吁吁奔入營帳):報...報...報！武將軍不過一合，便被斬去一臂，血流如注，染紅沙場...", 200, new Runnable() {
				            @Override
				            public void run() {
				            	Wu_name.setVisible(false);
				            	NPC_1.setVisible(false);
				            	My_name.setVisible(true);
				            	NPC_P.setVisible(true);
				                Q_2_Choosen_2.setVisible(true);
				                Q_2_Choosen_2.setText("安國竟如此不濟？盟軍無大將...吾將親自一會人中呂布，觀其真實之威！");
				                Conversation_2.setText("");
				                
				                //按下按鈕2後
				                Q_2_Choosen_2.addMouseListener(new MouseAdapter() {
				                    @Override
				                    public void mouseClicked(MouseEvent e) {
				                    	
				                    	//選擇->按鈕消失->繼續播放文字
				                        Q_2_Choosen_2.setVisible(false);
				                        
				        					WarMode sc = new WarMode();
				        					sc.setVisible(true);
				        					dispose();
				                    }
				                });
				            }
				        });
				        animator2_1.start();
		            }
		        });
		        animator2.start();
			};
        });
		
		
        
             
        JLabel Bin_name = new JLabel("【兵長】");
		Bin_name.setFont(new Font("新宋体", Font.BOLD, 25));
		Bin_name.setHorizontalAlignment(SwingConstants.LEFT);
		Bin_name.setForeground(new Color(255, 255, 255));
		Bin_name.setBounds(254, 11, 111, 35);
		panel_1_2.add(Bin_name);
        
		//開場文字對話互動
		JLabel Conversation_1 = new JLabel("");
		Conversation_1.setForeground(new Color(255, 255, 255));
		Conversation_1.setFont(new Font("新宋体", Font.BOLD, 20));
		Conversation_1.setBounds(367, 35, 887, 162);
		panel_1_2.add(Conversation_1);
		
		//傳令兵提問
		Opening_Choosen.setText("(傳令兵慌慌張張地闖入營帳，跪地稟報...)");
		Opening_Choosen.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
            	Opening_Choosen.setVisible(false);
            	TextAnimator animator1_1 = new TextAnimator(Conversation_1, "報...報！呂布戰無五合，斬方悅；手起一戟，誅穆順！兩位將軍瞬間喪命，無人能擋呂布...", 200, new Runnable() {
    	            @Override
    	            public void run() {
    	            	Bin_name.setVisible(false);
    					NPC_1.setVisible(false);
                        Q_1_Choosen_2.setVisible(true);
                        Q_1_Choosen_2.setText("(營帳內一片嘩然，諸侯將領皆驚愕不已...)");
                        Conversation_1.setText("");
                        //按下按鈕後
                        Q_1_Choosen_2.addMouseListener(new MouseAdapter() {
                        	@Override
                            public void mouseClicked(MouseEvent e) {
                              //選2
                                Q_1_Choosen_2.addMouseListener(new MouseAdapter() {
                                    @Override
                                    public void mouseClicked(MouseEvent e) {
                                    	
                                    	//選擇->按鈕消失->繼續播放文字
                                        Q_1_Choosen_2.setVisible(false);
                                    	
                                        TextAnimator animator1_2 = new TextAnimator(Conversation_1, "(抹去額上冷汗)：呂布神勇無匹，我軍士氣大受震動！軍心已經嚴重渙散......" ,200, new Runnable() {
                    	                    @Override
                    	                    public void run() {
                    	                    	panel_1_2.setVisible(false);
                    	                    	NPC_1.setVisible(false);
                    	                    	panel_3_4.setVisible(true);
                    	                    	NPC_2.setVisible(true);
                    	                    }
                    	                });
                                        animator1_2.start();
                                    };
                                });
                        	}
                        });
    	            }
    	        });
    	        animator1_1.start();
            }
        }); 
		
		
	    panel_3_4.setLayout(null);
	        
		
		
		        
		
		}
	
		//任意調整圖片比例
		private void setScaledImage(JLabel label, String imagePath) {
		ImageIcon icon = new ImageIcon(this.getClass().getResource(imagePath));
	 	Image image = icon.getImage();
	 	Image scaledImage = image.getScaledInstance(label.getWidth(), label.getHeight(), Image.SCALE_SMOOTH);
	 	label.setIcon(new ImageIcon(scaledImage));
		}
	}


